# 1. awk 사용법 알아보기

---

## 이전 페이지

[BASH](../BASH%20f8c8552169a843adb423b9063f9f5685.md)

## 다음 페이지

[2. awk 프로그래밍](2%20awk%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%80%E1%85%B3%E1%84%85%E1%85%A2%E1%84%86%E1%85%B5%E1%86%BC%20a8b77f3ae9d64915ae43bd12035db9aa.md)

---

셸 스크립트를 작성하다보면 시스템 파일 목록이나 컨테이너 목록 또는 애플리케이션 실행 결과에서 특정 컬럼에 해당하는 문자열을 추출하고, 해당 결과값을 이용하여 또 다른 명령어를 실행할 때 파라미터로 사용해야 하는 경우가 있다. 이런 경우 우리는 특정 인덱스 문자열을 출력할 수 있는 `awk` 명령어를 사용할 수 있다. `awk`는 앞에서 사전에 실행된 명령어의 결과나 파일로부터 레코드$^{record}$를 선택하고, 선택된 레코드의 특정 인덱스에 해당하는 값을 출력할 수 있다. 또한 선택된 레코드를 가지고, 패턴과 일치하는지를 확인하고, 데이터 조작 및 연산 등의 액션을 수행하여 그 결과를 출력한다. 그럼 지금부터 `awk` 명령어의 사용법을 알아보자.

`awk`는 GNU 기반의 `awk`인 `gawk`, `gawk`의 프로파일링 버전인 `pgawk`, `awk`의 디버거 역할을 하는 `dawk`가 있으며, 대부분의 GNU 기반의 리눅스에서 사용되고 있다. 그리고, BSD 계열이나 Debian 계열 리눅스에는 마이크 브레넌$^{Mike\ Brennan}$에 의해 만들어진 `mawk`가 사용된다. 두 가지 버전의 `awk`는 옵션 사용 시에만 약간의 차이가 있으며, 기능상의 차이는 없다. 따라서, 일반적으로 많이 사용되는 `gawk`를 기준으로 설명한다.

### 기본 사용법 1

`awk`의 가장 기본적인 사용법은 옵션, 어떤 문자열을 추출할 것인지를 기술한 `awk` 프로그램, 그리고 대상 파일로 이루어진다. `awk` 프로그램은 어떤 문자열을 추출할 것인지를 표현한 패턴과 어떤 인덱스의 문자열을 출력할 것인지에 대한 액션으로 이루어진다.

```bash
awk [옵션] '패턴 { 액션 }' 대상 파일
```

**예제1) `awk` 기본 사용법 1**

예제를 통해 `awk` 기본 사용법 1을 알아보자. 우선 4장의 파일을 찾을 수 있는 `Script` 디렉터리의 파일 목록을 `file-list.txt`라는 파일에 저장한다. 그리고, 두 번째 필드의 값이 `2`와 같을 경우 해당 라인을 출력하는데, 이때 해당 라인의 필드 개수에 해당하는 인덱스의 문자열을 출력한다. 여기서 `$2`는 두 번째 필드값을 의미하며, `$2 == 2`는 패턴에 해당한다. 그리고 `{}`(중괄호) 안의 `print`문은 액션에 해당한다. `$NF`는 Number of Field의 약자로 필드의 개수, 즉 마지막 필드의 문자열을 출력하겠다는 의미이다. `NF`는 `awk`에서 제공하는 내장 변수이다.

```bash
# git을 이용한 예제 파일 다운로드
$ git clone https://github.com/naleeJang/Easy-Shell-Script.git

# 예제 파일 압축 해제
$ tar fxv Easy-Shell-Script/04.Find/Script.tar

# Script 디렉터리 내 파일 목록을 file-list.txt에 저장
$ ls -al Script/ > file-list.txt

# 두 번째 필드값이 2인 레코드의 문자열 출력
$ awk '$2 == 2 { print $NF }' file-list.txt
File
pattern
```

### 기본 사용법 2

앞에서 살펴봤듯이 `awk`는 필드와 레코드를 가진 표 형식의 데이터를 추출할 때 매우 유용하게 사용될 수 있다. 그리고, `awk` 프로그램은 파일로 저장해두었다가 필요할 때 다음과 같이 `-f` 옵션과 함께 해당 파일을 로딩하여 대상 파일에서 필요로 하는 문자열을 추출할 수 있다.

```bash
awk [옵션] -f awk_프로그램_파일 대상 파일
```

**예제1) `awk` 기본 사용법 2**

`awk` 기본 사용법 1에서 사용했던 패턴과 액션을 `awk-prog.txt`라는 파일에 저장한다. 그리고 저장한 `awk-prog.txt` 파일을 이용하여 다음 예제와 같이 `-f` 옵션과 함께 사용하면 기본 사용법 1의 예제 결과와 동일한 결과를 확인할 수 있다.

```bash
# 패턴과 액션을 awk-prog.txt 파일에 저장
$ echo '$2 == 2 { print $NF }' > awk-prog.txt

# awk-prog.txt 파일을 이용하여 디렉터리명 추출
$ awk -f awk-prog.txt file-list.txt
File
pattern
```

### 기본 사용법 3

이번에 살펴볼 기본 사용법 3은 앞서 살펴본 사용법에 비해 가장 많이 사용되는 사용법이다. 리눅스 명령어나 애플리케이션의 명령어를 통해 얻은 결과를 이용해 해당 결과에서 필요한 문자열을 추출할 수 있다.

```bash
명령어 | awk [옵션] '패턴 { 액션 }'
```

**예제1) `awk` 기본 사용법 3**

다음 예제는 `ls -l` 명령어를 실행한 결과를 인자로 하여, `awk`를 이용해 `2`번째 필드값이 `2`와 같은 레코드의 마지막 필드값을 출력하는 예이다. 여기서, `ls -l`을 실행한 결과를 살펴보면 `2`번째 필드에 해당 경로가 디렉터리인지 파일인지를 구분하는 숫자가 표기되어 있다. `1`은 파일을 의미하며, `2`는 디렉터리를 의미한다. 따라서, 다음 예제는 파일 목록에서 디렉터리만 추출하여 해당 경로를 출력하는 예제이다.

```bash
# ls -l 실행 결과를 인자로 awk를 이용하여 디렉터리명 추출
$ ls -l Script/ | awk '$2 == 2 { print $NF }'
File
pattern
```

---

## 이전 페이지

## 다음 페이지