# 1. sed 사용법 알아보기

---

## 이전 페이지

[BASH](../BASH%20f8c8552169a843adb423b9063f9f5685.md)

## 다음 페이지

[2. sed 스크립트](2%20sed%20%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%B8%E1%84%90%E1%85%B3%2072e6ae65ca494cc1b6010fe564c1a688.md)

---

문서에 저장된 IP를 변경해야 하는 작업이 있다고 하자. 변경해야 할 값이 한두 개면 문서 편집기를 이용해 그냥 변경하면 된다. 하지만, 많은 양을 변경해야 한다면, 시간이 정말 많이 걸린다. 문서 편집기에서는 찾기와 바꾸기 기능을 사용하면 쉽게 할 수 있지만, 리눅스와 같은 시스템 환경 설정을 이처럼 변경해야 한다면 문서 편집기를 사용할 수도 없다. 이런 경우 `sed`를 이용하면 쉽게 변경해야 할 문자열을 찾아 변경하고자 하는 문자열로 변경할 수 있다. 특정 문자열을 찾아 원하는 문자열로 변경하는 것뿐만 아니라, 범위를 지정하고 해당 범위의 문자열을 변경할 수도 있다. 그럼, 지금부터 `sed`의 사용법과 다양한 옵션들을 알아보도록 하자.

`sed`는 스트림 편집기이다. 스트림 편집기는 입력 스트림에서 텍스트 변환을 수행하는 데 사용된다. 여기서 입력 스트림은 텍스트를 변경하고자 하는 대상 파일이며, 스크립트는 어떤 텍스트를 어떻게 변환할지 정의하는 일을 말한다. 그럼, 지금부터 `sed` 사용법을 알아보도록 하자.

### 기본 사용법 1

`sed`의 가장 기본적인 사용법은 옵션, 어떤 텍스트를 어떻게 변경할 것인지를 기술한 스크립트 그리고, 대상 파일이 필요하다. 그리고, 스크립트는 대상 파일의 범위를 지정하는 어드레스와 명령어로 이루어진다. 어드레스가 생략되면 `sed`는 대상 파일 전체를 대상으로 명령어를 수행한다.

```bash
sed [옵션] '어드레스 {명령어}' 대상 파일
```

**예제1) `sed` 기본 사용법 1**

예제를 통해 기본 사용법 1을 알아보자. 예를 들어 `ssh`로 원격 서버를 접근할 때 보안을 위해 `root` 사용자 계정으로는 접근을 못하게 설정하는 경우가 있다. 이런 경우 `sshd_config` 파일의 `PermitRootLogin`이라는 옵션을 `yes`로 설정하면 `root` 계정으로 로그인을 차단할 수 있다. 먼저 `grep`을 이용해 `/etc/ssh/sshd_config` 파일의 `PermitRootLogin`이라는 옵션이 있는지 먼저 찾아본다. 그런데, `PermitRootLogin`은 주석 처리가 되어 있다. 이때, `sed`를 이용해 `#PermitRootLogin`을 `PermitRootLogin`으로 다음과 같이 변경할 수 있다. `s/찾을문자열/변경문자열/`은 `sed`에서 가장 많이 사용되는 찾은 문자열을 원하는 문자열로 바꿔주는 명령어이다.

```bash
# grep을 이용해 변경할 대상 문자열 확인
$ cat /etc/ssh/sshd_config | grep '^#PermitRoot'
#PermitRootLogin yes

# /etc/ssh/sshd_config 파일의 #PermitRoot를 PermitRoot로 변경
$ sed 's/#PermitRoot/PermitRoot/' /etc/ssh/sshd_config | grep '^PermitRoot'
PermitRootLogin yes
```

### 기본 사용법 2

두 번째 기본 사용법은 찾을 문자열과 변경하고자 하는 문자열을 스크립트로 작성한 파일을 이용하여 대상 파일의 문자열을 변경하는 방법이다.

```bash
sed [옵션] -f 스크립트파일 대상 파일
```

**예제1) `sed` 기본 사용법 2**

앞에서 사용했던 스크립트 내용을 `sed-script.txt` 파일에 저장한다. 그리고, 저장한 파일을 이용하여 다음 예제와 같이 `sshd_config` 파일의 `PermitRootLogin`을 변경할 수 있다. 이때, Debian 계열의 리눅스에서는 `/etc/ssh_config` 파일을 `ssh` 설정 시 사용할 수 있으며, Fedora 계열의 리눅스는 다음 예제와 같이 `/etc/ssh/sshd_config` 파일을 `ssh` 설정 시 사용할 수 있다.

```bash
# 스크립트 내용을 echo를 이용해 sed-script.txt에 저장
$ echo "s/#PermitRootLogin/PermitRootLogin/" > sed-script.txt

# -f 옵션을 이용하여 저장한 스크립트 파일을 이용하여 sed 수행
$ sed -f sed-script.txt /etc/ssh/sshd_config | grep '^PermitRoot'
PermitRootLogin yes
```

### 기본 사용법 3

`sed`의 기본 사용법 3은 리눅스 명령어나 애플리케이션의 명령어를 통해 얻은 결과를 이용해 해당 결과에서 찾은 문자열을 변경할 때 주로 이용한다. 셸 스크립트 작성 시 다른 명령어들과 함께 사용되며, 특수 문자열을 변경할 경우 많이 사용된다.

```bash
명령어 | sed [옵션] '{스크립트}'
```

**예제1) `sed` 기본 사용법 3**

다음 예제는 `cat`을 이용해 `/etc/ssh/sshd_config` 파일 내용을 확인하고, `sed` 명령어를 통해 `cat` 결과에서 `#PermitRoot` 문자열을 찾아 `PermitRoot`로 변경한다. 그리고, 변경된 결과에서 다시 `grep`을 이용해 `PermitRoot`가 변경되었는지 확인한다. 이렇듯, 다양한 명령어를 조합하여 사용하면 쉽게 문자열을 찾고, 변경할 수 있다.

```bash
# cat을 이용해 /etc/ssh/sshd_config 내용을 확인하고, sed는 cat의 결과에서 해당 문자열 변경
$ cat /etc/ssh/sshd_config | sed -e 's/#PermitRoot/PermitRoot/' | grep '^PermitRoot'
PermitRootLogin yes
```

---

## 이전 페이지

## 다음 페이지